function Check_login(){var e=$("#login-form-dialog").html(),n=dialog({title:"提示",content:e,cancelValue:"关闭",ok:function(){},cancel:function(){}});n.showModal()}OT2.Ucenter=function(){var e=1,n="",t=function(){this.errors=[],this.checkFields=[]};t.prototype.checkForm=function(){this.errors=[];for(var e,n=0;e=this.checkFields[n++];){var t=e.checkIt();t&&this.errors.push(t)}return!this.errors.length},t.prototype.bindOnFocus=function(){for(var e,n=0;e=this.checkFields[n++];)e.addRule("focus",function(){this.removeError()},!1)};var i=function(){var e=new t;return _.extend(e,{addCheckField:function(){var e=new OT2.Field("#truename");e.addRule("blur",function(e){return e.length<=0?"请输入真实姓名！":e.length<2?"真实姓名格式不对！":void 0}),this.checkFields.push(e)},init:function(e){var n=this;this.addCheckField(),this.bindOnFocus(),$("form").on("submit",function(){var e=n.checkForm();return!!e})}}),{form:e}},r=function(e){var n=dialog({title:"提示",content:'<p style="text-align: center; margin-top: 40px;">你确定要删除这个消息吗？</p>',okValue:"确定",cancelValue:"取消",ok:function(){window.location="/ucenter/msg-delete?id="+$(e).attr("mid")},cancel:function(){}});n.showModal()},o=function(){var i=function(){$(".safe-bind").each(function(){var e=this,n=!1;$(this).find(".bind-btn").on("click",function(){$(e).find(".bind-con").toggle(),n=!n,$(this).find("span").html(n?"∧":"∨")})})},r=function(e){t.call(this),this.name=e.name,this.$form=$(e)};return r.prototype={addCheckField:function(){"mobile-form"==this.name&&this.addCheckFieldForMobile(),"email-form"==this.name&&this.addCheckFieldForEmail(),"password-form"==this.name&&this.addCheckFieldForPass()},addCheckFieldForMobile:function(){var n=this,t=new OT2.Field("#mobile");this.mobileField=t,t.addRule("blur validate",function(e){if(0==e.length)return"请输入手机号码！";if(!/^(13[0-9]|15[0-9]|17[0-9]|18[0-9]|14[57])\d{8}$/.test(e))return"手机号码不正确！";if(e==$("#_mobile").val)return"请输入新的手机号码";var n=this.$el.data("res");return n==e?"该手机号码已经被注册过！":void 0}),this.checkFields.push(t),t=new OT2.Field("#code"),t.addRule("blur",function(n){return 0==n.length?"请输入手机验证码！":4!=n.length?"请输入4位验证码！":0==e?"验证码错误！":void 0}),$("#J_getCode").on("click",function(e){var t=n.mobileField.checkIt();return!t&&void OT2.Util.getCode(this)}),t.addRule("change",function(e){}),$("#submit_mobile").bind("click",function(){if(!n.checkForm())return!1;var t=$("#code").val(),i=$.Deferred();return $.post("/ucenter/check-code",{code:t,mobile:$("#mobile").val()},"json").done(function(n){0==n.errCode?window.location.reload():(e=0,$("#code").trigger("blur"))}).fail(),i.promise()})},addCheckFieldForEmail:function(){var e=new OT2.Field("#email");e.addRule("blur",function(e){return 0==e.length?"请输入邮箱地址！":/(?:[A-Za-z\d][\w!#$%&'*+-\/=?^`{|}~]{0,200}\.?)+@[A-Za-z\d][A-Za-z\d\-\.]*\.[A-Za-z]{2,6}/.test(e)?void 0:"邮箱地址格式不正确！"}),this.checkFields.push(e)},addCheckFieldForPass:function(){var e=null,t=this;$("#_password").length>0&&(e=new OT2.Field("#_password"),e.addRule("blur",function(e){return 0==e.length?"请输入旧密码！":/^[\w_]{6,20}$/.test(e)?""!=n?n:void 0:"密码由6-20个英文字母、数字或下划线组成！"}),e.addRule("change",function(e){n=""}),this.checkFields.push(e)),e=new OT2.Field("#password1");var i=e;e.addRule("blur",function(e){if(0==e.length)return"请输入新密码！";if(!/^[\w_]{6,20}$/.test(e))return"密码由6-20个英文字母、数字或下划线组成！";var n=r.getVal();return n&&n!=e?"确认密码输入不一致！":void(n&&n==e&&(r.removeError(),i.removeError()))}),$("#submit_psw").bind("click",function(){if(!t.checkForm())return!1;var e=$("[name = password-form]").serializeArray(),i=($("#_password").val(),$.Deferred());return $.post("/ucenter/update-psw",{form:e},"json").done(function(e){if(0==e.errCode){$("[name = password-form]")[0].reset(),n="";var t=dialog({title:"提示",content:'<div class="email-con"><h1>'+e.message+"</h1></div>"},1);t.showModal()}else n=e.message,$("#_password").trigger("blur")}).fail(),i.promise()}),this.checkFields.push(e),e=new OT2.Field("#password2");var r=e;e.addRule("blur",function(e){if(0==e.length)return"请输入确认密码！";if(!/^[\w_]{6,20}$/.test(e))return"密码由6-20个英文字母、数字或下划线组成！";var n=i.getVal();return n&&n!=e?"确认密码输入不一致！":void(n&&n==e&&(i.removeError(),r.removeError()))}),this.checkFields.push(e)},sendEmail:function(e){var n=dialog({title:"提示",content:_.template(OT2.Util.Template().get("send-email"),{content:e}),okValue:"确定",cancelValue:"关闭",ok:function(){},cancel:function(){}});n.showModal()},bindEvent:function(){var e=this;this.$form.on("submit",function(n){if(n.preventDefault(),!e.checkForm())return!1;if("email-form"==e.name){var t=$("#email").val(),i="";$.post("/site/send-email",{email:t},"json").done(function(n){i=0==n.errCode?'<h1>验证邮箱发送成功</h1><p>请进入邮箱 <a href="'+n.message+'" target="_blank">'+t+"</a> 点击链接激活邮箱</p>":n.message?n.message:"服务器发生错误",e.sendEmail(i)}).fail()}return!1})},init:function(){this.addCheckField(),this.bindOnFocus(),this.bindEvent()}},_.extend(r.prototype,t.prototype),{tab:i,Form:r}},a=function(){};return{userinfo:i,delmsg:r,safe:o,setting:a}}();